

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Register asset on a remote agent &mdash; starfish-py 0.14.1 documentation</title>
  

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="_static/graphviz.css" type="text/css" />

  
  
  
  

  
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
        <script src="_static/language_data.js"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Starfish Tools" href="starfish_tools.html" />
    <link rel="prev" title="Starfish Agents" href="agents.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home" alt="Documentation Home"> starfish-py
          

          
          </a>

          
            
            
              <div class="version">
                0.14.1
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="getting_started.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="agents.html">Starfish Agents</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Register asset on a remote agent</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#creating-a-new-dnetwork-instance">Creating a new <cite>DNetwork</cite> instance</a></li>
<li class="toctree-l2"><a class="reference internal" href="#create-an-asset">Create an Asset</a></li>
<li class="toctree-l2"><a class="reference internal" href="#setup-the-remote-agent">Setup the Remote Agent</a></li>
<li class="toctree-l2"><a class="reference internal" href="#register-the-asset">Register the Asset</a></li>
<li class="toctree-l2"><a class="reference internal" href="#saving-the-asset">Saving the Asset</a></li>
<li class="toctree-l2"><a class="reference internal" href="#full-example-to-register-and-upload-an-asset-on-remote-agent">Full example to register and upload an Asset on Remote Agent</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="starfish_tools.html">Starfish Tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="classes/account.html">Account class</a></li>
<li class="toctree-l1"><a class="reference internal" href="classes/agent.html">Agent Classes</a></li>
<li class="toctree-l1"><a class="reference internal" href="classes/asset.html">Asset Classes</a></li>
<li class="toctree-l1"><a class="reference internal" href="classes/dnetwork.html">DNetwork class</a></li>
<li class="toctree-l1"><a class="reference internal" href="classes/job.html">Job Classes</a></li>
<li class="toctree-l1"><a class="reference internal" href="classes/listing.html">Listing Classes</a></li>
<li class="toctree-l1"><a class="reference internal" href="classes/provenance.html">Provenance module</a></li>
<li class="toctree-l1"><a class="reference internal" href="classes/purchase.html">Purchase Classes</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">starfish-py</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li>Register asset on a remote agent</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/register_asset_remote_agent.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="register-asset-on-a-remote-agent">
<h1>Register asset on a remote agent<a class="headerlink" href="#register-asset-on-a-remote-agent" title="Permalink to this headline">¶</a></h1>
<p>This is to show how to register an asset on a remote agent.</p>
<p>The remote agent (Surfer) is a centralized server that allows the server url to be registered on the Ocean/Dex Network.</p>
<p>Any asset registered with a remote agent will not be written to the block chain, but the returned
DID will contain the Remote Agent DID/asset_id. This can be resolved by using the Ocean/Dex Protocol network
to obtain the asset.</p>
<p>We assume that you have already setup a test <cite>barge</cite> in ‘Getting Started’, with a running remote agent in Barge.</p>
<div class="section" id="creating-a-new-dnetwork-instance">
<h2>Creating a new <cite>DNetwork</cite> instance<a class="headerlink" href="#creating-a-new-dnetwork-instance" title="Permalink to this headline">¶</a></h2>
<p>First import the main starfish ocean library, and the logging library</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">starfish</span> <span class="kn">import</span> <span class="n">DNetwork</span>
</pre></div>
</div>
<p>Next create an instance and a basic connection to the ocean network, with
some extra logging so you can see what is happening.</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">network</span> <span class="o">=</span> <span class="n">DNetwork</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">network</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;http://localhost:8545&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="create-an-asset">
<h2>Create an Asset<a class="headerlink" href="#create-an-asset" title="Permalink to this headline">¶</a></h2>
<p>We now want to create an asset to register with the remote agent, we can store it’s metadata and data
all with agent.</p>
<p>First we need to create a data asset, using some test data.</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">starfish.asset</span> <span class="kn">import</span> <span class="n">DataAsset</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">asset</span> <span class="o">=</span> <span class="n">DataAsset</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="s1">&#39;MyAsset&#39;</span><span class="p">,</span> <span class="s1">&#39;Here is some test text that I want to save in remote agent service&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>Let see what’s in the DataAsset metadata</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">asset</span><span class="o">.</span><span class="n">metadata</span><span class="p">)</span>
<span class="go">{&#39;name&#39;: &#39;MyAsset&#39;, &#39;type&#39;: &#39;dataset&#39;, &#39;contentType&#39;: &#39;text/plain; charset=utf-8&#39;}</span>
</pre></div>
</div>
<p>and what is in the DataAsset data property</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">asset</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
<span class="go">Here is some test text that I want to save in remote agent service</span>
</pre></div>
</div>
<p>Now see if the asset has a DID?</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">asset</span><span class="o">.</span><span class="n">did</span><span class="p">)</span>
<span class="go">None</span>
</pre></div>
</div>
</div>
<div class="section" id="setup-the-remote-agent">
<h2>Setup the Remote Agent<a class="headerlink" href="#setup-the-remote-agent" title="Permalink to this headline">¶</a></h2>
<p>We now need an agent to register and manage our Asset. The agents
task is to do the actual work of registration.</p>
<p>First we need to import the agent and setup it’s configuration for the local test Barge.</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">starfish.agent</span> <span class="kn">import</span> <span class="n">RemoteAgent</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">url</span> <span class="o">=</span> <span class="s1">&#39;http://localhost:8080&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">options</span> <span class="o">=</span> <span class="p">{</span>
<span class="go">        &#39;url&#39;: url,</span>
<span class="go">        &#39;username&#39;: &#39;test&#39;,</span>
<span class="go">        &#39;password&#39;:  &#39;foobar&#39;,</span>
<span class="go">    }</span>
</pre></div>
</div>
<p>Since this is probably the first time we are using remote agent, we need to register
all of the services that remote agent supports on the Network. In our case
the Network is going to be the local Barge.</p>
<p>So first create a DDO record for the local remote agent service.</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">ddo</span> <span class="o">=</span> <span class="n">RemoteAgent</span><span class="o">.</span><span class="n">generate_ddo</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
</pre></div>
</div>
<p>Lets see what the DID of the remote agent service is going to be?</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">ddo</span><span class="o">.</span><span class="n">did</span><span class="p">)</span>
<span class="go">did:dep:45fd1d44764047808b313bf777d98d6304fdf9ff3ba7463aa4346e888ff5041c</span>
</pre></div>
</div>
<p>We can now create the remote agent using the options provided</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">agent</span> <span class="o">=</span> <span class="n">RemoteAgent</span><span class="p">(</span><span class="n">network</span><span class="p">,</span> <span class="n">did</span><span class="o">=</span><span class="n">ddo</span><span class="o">.</span><span class="n">did</span><span class="p">,</span> <span class="n">ddo</span><span class="o">=</span><span class="n">ddo</span><span class="p">,</span> <span class="n">options</span><span class="o">=</span><span class="n">options</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="register-the-asset">
<h2>Register the Asset<a class="headerlink" href="#register-the-asset" title="Permalink to this headline">¶</a></h2>
<p>First we need to create some listing data. This data is linked with the asset for public
view and provide more information about the asset.</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">listing_data</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;My data&#39;</span><span class="p">,</span> <span class="s1">&#39;author&#39;</span><span class="p">:</span> <span class="s1">&#39;Help writer&#39;</span><span class="p">,</span> <span class="s1">&#39;license&#39;</span><span class="p">:</span> <span class="s1">&#39;CC0: Public Domain&#39;</span><span class="p">}</span>
</pre></div>
</div>
<p>Now we can register the asset we have created earlier. This will return
a :class:.Listing object. The listing object will contain all of the information
for selling the asset, such as price, where to obtain the asset, any samples, and more
information about the asset.</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">listing</span> <span class="o">=</span> <span class="n">agent</span><span class="o">.</span><span class="n">register_asset</span><span class="p">(</span><span class="n">asset</span><span class="p">,</span> <span class="n">listing_data</span><span class="p">)</span>
</pre></div>
</div>
<p>We can find out what the listing id has been assigned to us by remote agent</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">listing</span><span class="o">.</span><span class="n">listing_id</span><span class="p">)</span>
<span class="go">a3392ea6f7b7301bb81c4fe58ad0959360d53662ce3a3d35589f9fbd0e276699</span>
</pre></div>
</div>
<p>Lets find out what the asset or listing DID</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">listing</span><span class="o">.</span><span class="n">did</span><span class="p">)</span>
<span class="go">did:dep:45fd1d44764047808b313bf777d98d6304fdf9ff3ba7463aa4346e888ff5041c/3bd774d7d7ee5239c26b39b44b659a2488cc3fcdd17140274b04bfc0a05520f5</span>
</pre></div>
</div>
<p>You will notice that the listing DID returned contains two id’s. The first is the regisered DID on the
block chain, the second id is the internall asset id registered on the remote agent.</p>
<p>To check that the asset id is the same we can print out the asset id</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">listing</span><span class="o">.</span><span class="n">asset</span><span class="o">.</span><span class="n">asset_id</span><span class="p">)</span>
<span class="go">0x3bd774d7d7ee5239c26b39b44b659a2488cc3fcdd17140274b04bfc0a05520f5</span>
</pre></div>
</div>
</div>
<div class="section" id="saving-the-asset">
<h2>Saving the Asset<a class="headerlink" href="#saving-the-asset" title="Permalink to this headline">¶</a></h2>
<p>With the remote agent we can now save the asset data. To do this we just need to call the <cite>upload</cite> method in the remote agent.</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">agent</span><span class="o">.</span><span class="n">upload_asset</span><span class="p">(</span><span class="n">asset</span><span class="p">)</span>
<span class="go">True</span>
</pre></div>
</div>
<p>N.B. Rememeber you can only upload and download in asset with the remote agent if you have registered it before hand.</p>
</div>
<div class="section" id="full-example-to-register-and-upload-an-asset-on-remote-agent">
<h2>Full example to register and upload an Asset on Remote Agent<a class="headerlink" href="#full-example-to-register-and-upload-an-asset-on-remote-agent" title="Permalink to this headline">¶</a></h2>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/env python3</span>

<span class="kn">from</span> <span class="nn">starfish.network.ethereum.ethereum_network</span> <span class="kn">import</span> <span class="n">EthereumNetwork</span>
<span class="kn">from</span> <span class="nn">starfish.asset</span> <span class="kn">import</span> <span class="n">DataAsset</span>
<span class="kn">from</span> <span class="nn">starfish.agent</span> <span class="kn">import</span> <span class="n">RemoteAgent</span><span class="p">,</span> <span class="n">AgentManager</span>
<span class="kn">from</span> <span class="nn">starfish.agent.services</span> <span class="kn">import</span> <span class="n">Services</span>

<span class="k">def</span> <span class="nf">main</span><span class="p">():</span>

    <span class="c1"># Create a new Ocean instance.</span>
    <span class="n">network</span> <span class="o">=</span> <span class="n">EthereumNetwork</span><span class="p">(</span><span class="s1">&#39;http://localhost:8545&#39;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">network</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>

    <span class="c1"># Create a remote agent to do the work.</span>
    <span class="n">agent_url</span> <span class="o">=</span> <span class="s1">&#39;http://localhost:3030&#39;</span>

    <span class="n">authentication</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;username&#39;</span><span class="p">:</span> <span class="s1">&#39;Aladdin&#39;</span><span class="p">,</span>
        <span class="s1">&#39;password&#39;</span><span class="p">:</span>  <span class="s1">&#39;OpenSesame&#39;</span><span class="p">,</span>
    <span class="p">}</span>

    <span class="c1"># find an agent based on it&#39;s url, you can also use an agent did or asset did instead</span>
    <span class="n">agent</span> <span class="o">=</span> <span class="n">RemoteAgent</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">agent_url</span><span class="p">,</span> <span class="n">network</span><span class="p">,</span> <span class="n">authentication</span><span class="o">=</span><span class="n">authentication</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">agent</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;failed to find the agent&#39;</span><span class="p">)</span>

    <span class="c1"># create a listing specifying the information about the asset</span>
    <span class="n">listing_data</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;The white paper&#39;</span><span class="p">,</span>
        <span class="s1">&#39;author&#39;</span><span class="p">:</span> <span class="s1">&#39;Ocean Protocol&#39;</span><span class="p">,</span>
        <span class="s1">&#39;license&#39;</span><span class="p">:</span> <span class="s1">&#39;CC0: Public Domain&#39;</span><span class="p">,</span>
        <span class="s1">&#39;price&#39;</span><span class="p">:</span> <span class="s1">&#39;0&#39;</span>
    <span class="p">}</span>

    <span class="c1"># Now create a memory asset</span>
    <span class="n">asset</span> <span class="o">=</span> <span class="n">DataAsset</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="s1">&#39;TestAsset&#39;</span><span class="p">,</span> <span class="s1">&#39;Some test data that I want to save for this asset&#39;</span><span class="p">)</span>

    <span class="n">asset</span><span class="o">.</span><span class="n">add_provenance_publish</span><span class="p">(</span><span class="n">agent</span><span class="o">.</span><span class="n">did</span><span class="p">)</span>

    <span class="c1"># Print the asset data</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;my asset:&#39;</span><span class="p">,</span> <span class="n">asset</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>

    <span class="n">asset</span> <span class="o">=</span> <span class="n">agent</span><span class="o">.</span><span class="n">register_asset</span><span class="p">(</span><span class="n">asset</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">asset</span><span class="o">.</span><span class="n">did</span><span class="p">)</span>
    <span class="n">listing</span> <span class="o">=</span> <span class="n">agent</span><span class="o">.</span><span class="n">create_listing</span><span class="p">(</span><span class="n">listing_data</span><span class="p">,</span> <span class="n">asset</span><span class="o">.</span><span class="n">did</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">listing</span><span class="o">.</span><span class="n">did</span><span class="p">,</span> <span class="n">listing</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>

    <span class="c1"># now upload the asset data to Surfer</span>
    <span class="n">agent</span><span class="o">.</span><span class="n">upload_asset</span><span class="p">(</span><span class="n">asset</span><span class="p">)</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">main</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="starfish_tools.html" class="btn btn-neutral float-right" title="Starfish Tools" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="agents.html" class="btn btn-neutral float-left" title="Starfish Agents" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        
        &copy; Copyright starfish-py contributors

    </p>
  </div>
    
    
    
    Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>